#cloud-config
# vim: syntax=yaml
users:
  - name: james
    shell: /bin/bash
    ssh_authorized_keys:
       - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPSnh+aoapGrwdL8CuhiZzKmnWqCAe6MyeP+Mzsuk353 jamesaallsopp@googlemail.com
  - name: ansible
    shell: /bin/bash
    sudo: ALL=(ALL) NOPASSWD:ALL
    ssh_authorized_keys:
       - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINVE5XKEzBUoobJAaETBR+YrzQC/CVfAgYiRc0lQ7sB9 jamesaallsopp@googlemail.com
packages:
  - openldap
  - openldap-clients
  - openldap-servers
  - compat-openldap

fqdn: ${fqdn}
*ssh_pwauth: True
chpasswd:
  list: |
     root:d2645c4c7f8650790107717425487fbee72f97d76b5ebe67f1b4b98570c94c4e
     james:2487fbd0efc89549c67311e20830384bf58823961e30b0937e4226fbd1ec02fc
     ansible:ae5446d4ecc034a35d9be604439143a68e9dcdebe47b5958f63f2b489854e524
  expire: False
disable_root: false

growpart:
  mode: auto
  devices: ['/']

runcmd:
 - sed  -i '/PermitRootLogin/s/.*/PermitRootLogin no/' /etc/ssh/sshd_config 
 - systemctl restart sshd
 - systemctl restart NetworkManager

